# Cubli_Mini_S_Pro项目源码

### 固件说明

MCU2运行3路Simple FOC电机驱动库、以及CAN反馈和接收控制命令

MCU1运行采集IMU，光污染，控制等任务

### 代码部分说明
- bsp 驱动相关，包含ADC，CAM,EEPROM,KEY,LED,NTC,OLED外设的驱动
- comm 共同的模块，bit32，lock，time，type
- config IO配置，参数默认配置都在这里
- control 立方体的主要控制都在这，包括自动校准，边、点平衡控制，串口调参等
- imu 主要为imu的驱动以及解算程序
- state 状态机实现以及各类子状态的实现
- task 使用了RTOS的task封装了一个异步task，用来给一些需要异步执行的任务使用
- web web简易界面和命令解析

### 控制算法

Cubli_Mini使用的是LQR来进行控制，也可以使用串级PID来进行控制。代码位于/需要修改/MCU1/control/cubli_mini

**边平衡**：

- 可以参考一阶倒立摆进行建模和求解参数。由于建立模型的参数比较难准确的获得，我求解得到的参数和最佳参数有些许出入。因此本项目大多数使用玄学调参工程师来整定参数

**点平衡：**

- 在边平衡的基础上添加对X，Z轴的控制。采用与边平衡一样的控制方法，详情看Doc/控制原理说明。

**研究型：**

- 请查看原版Cubli的论文

### 调参

**简易上位机**

- 使用了vofa+进行调参，使用了控件和命令绑定的方式进行调参，保存的文件位于：3.Software/vofa+.tabviews.json
- 只需要使用控件调参拖拽即可，无需了解任何命令

**简易web界面**

- 立方体初始化后，查找cubli_mini_s_pro AP并连接，密码88888888；在浏览器输入192.168.4.1登录即可开始调试

**固件烧录**

- 可使用3.Software/flash_download_tool_release2.1乐鑫的官方烧录软件进行烧录，无需编译源码烧录